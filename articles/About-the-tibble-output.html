<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="openalexR">
<title>About the tibble output • openalexR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="About the tibble output">
<meta property="og:description" content="openalexR">
<meta property="og:image" content="https://massimoaria.github.io/openalexR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">openalexR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/A_Brief_Introduction_to_openalexR.html">A Brief Introduction to openalexR</a>
    <a class="dropdown-item" href="../articles/About-the-tibble-output.html">About the tibble output</a>
    <a class="dropdown-item" href="../articles/Filters.html">Filters</a>
    <a class="dropdown-item" href="../articles/institution.html">Transition towards Open Access</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/massimoaria/openalexR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>About the tibble output</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/massimoaria/openalexR/blob/HEAD/vignettes/articles/About-the-tibble-output.Rmd" class="external-link"><code>vignettes/articles/About-the-tibble-output.Rmd</code></a></small>
      <div class="d-none name"><code>About-the-tibble-output.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/massimoaria/openalexR" class="external-link">openalexR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>The default output from an <code>oa_fetch</code> call is a tibble.
This object type allows each row to be one unit of entity (article,
institution, etc.), which is often helpful for downstream wrangling. It
<strong>simplifies</strong> and combines complex output elements in <a href="https://dcl-prog.stanford.edu/list-columns.html" class="external-link">list columns</a>,
which can be <strong>extracted</strong> or <strong>exploded</strong>
with <code><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">dplyr::rowwise</a></code> or <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map</a></code>.</p>
<p><strong>IMPORTANT</strong>: in “flattening” the list output to a
tibble, we have made a few decisions to simplify the original nested
list such as retaining only one affiliation for each author if you’re
querying <em>Works</em> (details in <a href="https://github.com/massimoaria/openalexR/blob/main/R/oa2df.R" class="external-link"><code>oa_df</code>
source code</a>). While the tibble output is sufficient in most use
cases, you may need to obtain the original nested list with all the
information on an entity for your special research problem. If so,
please specify <code>output = "list"</code> in your
<code>oa_fetch</code> call.</p>
<div class="section level2">
<h2 id="example-1-institutions">Example 1: institutions<a class="anchor" aria-label="anchor" href="#example-1-institutions"></a>
</h2>
<p>Suppose we queried Open Alex to obtain information on large Canadian
institutions and now want to <strong>extract their latitudes and
longitudes</strong>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">institutions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oa_fetch.html">oa_fetch</a></span><span class="op">(</span></span>
<span>  entity <span class="op">=</span> <span class="st">"institutions"</span>,</span>
<span>  country_code <span class="op">=</span> <span class="st">"CA"</span>,</span>
<span>  cited_by_count <span class="op">=</span> <span class="st">"&gt;4000000"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  count_only <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Requesting url: https://api.openalex.org/institutions?filter=country_code%3ACA%2Ccited_by_count%3A%3E4000000</span></span>
<span><span class="co">#&gt; Getting 1 page of results with a total of 11 records...</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">institutions</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 22</span></span></span>
<span><span class="co">#&gt;   id          displ…¹ displ…² displ…³ inter…⁴ ror   ids      count…⁵ geo   type </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lis&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> https://op… Univer… &lt;lgl&gt;   &lt;lgl&gt;   &lt;df&gt;    http… &lt;tibble&gt; CA      &lt;df&gt;  educ…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> https://op… Univer… &lt;lgl&gt;   &lt;chr&gt;   &lt;df&gt;    http… &lt;tibble&gt; CA      &lt;df&gt;  educ…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> https://op… Univer… &lt;chr&gt;   &lt;lgl&gt;   &lt;df&gt;    http… &lt;tibble&gt; CA      &lt;df&gt;  educ…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> https://op… McGill… &lt;lgl&gt;   &lt;lgl&gt;   &lt;df&gt;    http… &lt;tibble&gt; CA      &lt;df&gt;  educ…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> https://op… Univer… &lt;lgl&gt;   &lt;chr&gt;   &lt;df&gt;    http… &lt;tibble&gt; CA      &lt;df&gt;  educ…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> https://op… Univer… &lt;chr&gt;   &lt;chr&gt;   &lt;df&gt;    http… &lt;tibble&gt; CA      &lt;df&gt;  educ…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 12 more variables: homepage_url &lt;chr&gt;, image_url &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   image_thumbnail_url &lt;chr&gt;, associated_institutions &lt;list&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   relevance_score &lt;lgl&gt;, works_count &lt;int&gt;, cited_by_count &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   counts_by_year &lt;list&gt;, works_api_url &lt;chr&gt;, x_concepts &lt;list&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   updated_date &lt;chr&gt;, created_date &lt;chr&gt;, and abbreviated variable names</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ¹​display_name, ²​display_name_alternatives, ³​display_name_acronyms,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ⁴​international, ⁵​country_code</span></span></span></code></pre></div>
<p>We present three different approaches below.</p>
<div class="section level3">
<h3 id="dplyrrowwise">dplyr::rowwise<a class="anchor" aria-label="anchor" href="#dplyrrowwise"></a>
</h3>
<p>The use of <a href="https://dplyr.tidyverse.org/articles/rowwise.html" class="external-link"><code>rowwise</code></a>
used to be <a href="https://community.rstudio.com/t/dplyr-alternatives-to-rowwise/8071" class="external-link">discouraged</a>,
but the tidyverse team has now recognized its importance in many
workflows, and so <code>rowwise</code> is here to stay. We think
<code>rowwise</code> pairs very naturally with our list columns
output.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">institutions</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="va">display_name</span>,</span>
<span>    openalex_id <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">id</span>, <span class="st">"I\\d+"</span><span class="op">)</span>,</span>
<span>    lat <span class="op">=</span> <span class="va">geo</span><span class="op">$</span><span class="va">latitude</span>,</span>
<span>    lon <span class="op">=</span> <span class="va">geo</span><span class="op">$</span><span class="va">longitude</span>,</span>
<span>    .keep <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 11 × 4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Rowwise: </span></span></span>
<span><span class="co">#&gt;    name                           openalex_id   lat    lon</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> University of Toronto          I185261750   43.7  -<span style="color: #BB0000;">79.4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> University of British Columbia I141945490   49.3 -<span style="color: #BB0000;">123.</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> University of Alberta          I154425047   53.5 -<span style="color: #BB0000;">114.</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> McGill University              I5023651     45.5  -<span style="color: #BB0000;">73.6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> University of Calgary          I168635309   51.1 -<span style="color: #BB0000;">114.</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> University of Waterloo         I151746483   43.5  -<span style="color: #BB0000;">80.5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Western University             I125749732   43.0  -<span style="color: #BB0000;">81.3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> University of Ottawa           I153718931   45.4  -<span style="color: #BB0000;">75.7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> University of Montreal         I70931966    45.5  -<span style="color: #BB0000;">73.6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> McMaster University            I98251732    43.3  -<span style="color: #BB0000;">79.9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> Université Laval               I43406934    46.8  -<span style="color: #BB0000;">71.3</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="purrrmap">purrr::map<a class="anchor" aria-label="anchor" href="#purrrmap"></a>
</h3>
<p>Alternatively, you can use any function in the
<code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map</a></code> family. As you can see below, the syntax is a
little less natural, but you <em>may</em> gain some performance
advantage if you have a really large dataframe.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">institutions</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="va">display_name</span>,</span>
<span>    openalex_id <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">id</span>, <span class="st">"I\\d+"</span><span class="op">)</span>,</span>
<span>    lat <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">geo</span>, <span class="op">~</span> <span class="va">.x</span><span class="op">$</span><span class="va">latitude</span><span class="op">)</span>,</span>
<span>    lon <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">geo</span>, <span class="op">~</span> <span class="va">.x</span><span class="op">$</span><span class="va">longitude</span><span class="op">)</span>,</span>
<span>    .keep <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 11 × 4</span></span></span>
<span><span class="co">#&gt;    name                           openalex_id   lat    lon</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> University of Toronto          I185261750   43.7  -<span style="color: #BB0000;">79.4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> University of British Columbia I141945490   49.3 -<span style="color: #BB0000;">123.</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> University of Alberta          I154425047   53.5 -<span style="color: #BB0000;">114.</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> McGill University              I5023651     45.5  -<span style="color: #BB0000;">73.6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> University of Calgary          I168635309   51.1 -<span style="color: #BB0000;">114.</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> University of Waterloo         I151746483   43.5  -<span style="color: #BB0000;">80.5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Western University             I125749732   43.0  -<span style="color: #BB0000;">81.3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> University of Ottawa           I153718931   45.4  -<span style="color: #BB0000;">75.7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> University of Montreal         I70931966    45.5  -<span style="color: #BB0000;">73.6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> McMaster University            I98251732    43.3  -<span style="color: #BB0000;">79.9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> Université Laval               I43406934    46.8  -<span style="color: #BB0000;">71.3</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="baselapply">base::lapply<a class="anchor" aria-label="anchor" href="#baselapply"></a>
</h3>
<p>Similar to the purrr approach, you can use the base functions in the
<code>lapply</code> family, for example:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">institutions</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="va">display_name</span>,</span>
<span>    openalex_id <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">id</span>, <span class="st">"I\\d+"</span><span class="op">)</span>,</span>
<span>    lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">geo</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">latitude</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    lon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">geo</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">longitude</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    .keep <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 11 × 4</span></span></span>
<span><span class="co">#&gt;    name                           openalex_id   lat    lon</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> University of Toronto          I185261750   43.7  -<span style="color: #BB0000;">79.4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> University of British Columbia I141945490   49.3 -<span style="color: #BB0000;">123.</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> University of Alberta          I154425047   53.5 -<span style="color: #BB0000;">114.</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> McGill University              I5023651     45.5  -<span style="color: #BB0000;">73.6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> University of Calgary          I168635309   51.1 -<span style="color: #BB0000;">114.</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> University of Waterloo         I151746483   43.5  -<span style="color: #BB0000;">80.5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Western University             I125749732   43.0  -<span style="color: #BB0000;">81.3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> University of Ottawa           I153718931   45.4  -<span style="color: #BB0000;">75.7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> University of Montreal         I70931966    45.5  -<span style="color: #BB0000;">73.6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> McMaster University            I98251732    43.3  -<span style="color: #BB0000;">79.9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> Université Laval               I43406934    46.8  -<span style="color: #BB0000;">71.3</span></span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="example-2-works">Example 2: works<a class="anchor" aria-label="anchor" href="#example-2-works"></a>
</h2>
<p>Suppose we have a tibble of <strong>works</strong> output and would
like to find the institutions corresponding with the works’ authors. In
this case, each work may have more than one affiliated institutions.</p>
<div class="section level3">
<h3 id="tibble-output">Tibble output<a class="anchor" aria-label="anchor" href="#tibble-output"></a>
</h3>
<p>Assuming that each author is affiliated with only one institution, we
can call <code>oa_fetch</code> with the default
<code>output = "tibble"</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">works</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oa_fetch.html">oa_fetch</a></span><span class="op">(</span></span>
<span>  entity <span class="op">=</span> <span class="st">"works"</span>,</span>
<span>  title.search <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bibliometric analysis"</span>, <span class="st">"science mapping"</span><span class="op">)</span>,</span>
<span>  cited_by_count <span class="op">=</span> <span class="st">"&gt;100"</span>,</span>
<span>  from_publication_date <span class="op">=</span> <span class="st">"2020-01-01"</span>,</span>
<span>  to_publication_date <span class="op">=</span> <span class="st">"2021-01-31"</span>,</span>
<span>  sort <span class="op">=</span> <span class="st">"cited_by_count:desc"</span>,</span>
<span>  count_only <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We will store the result in a list column:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multi_insts</span> <span class="op">&lt;-</span> <span class="va">works</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    openalex_id <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">id</span>, <span class="st">"W\\d+"</span><span class="op">)</span>,</span>
<span>    institutions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">author</span><span class="op">$</span><span class="va">institution_display_name</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    .keep <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">multi_insts</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 2</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Rowwise: </span></span></span>
<span><span class="co">#&gt;    openalex_id institutions</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> W3038273726 <span style="color: #949494;">&lt;chr [2]&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> W2990450011 <span style="color: #949494;">&lt;chr [2]&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> W3001491100 <span style="color: #949494;">&lt;chr [2]&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> W3044902155 <span style="color: #949494;">&lt;chr [1]&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> W3011866596 <span style="color: #949494;">&lt;chr [1]&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> W2990688366 <span style="color: #949494;">&lt;chr [3]&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> W3000910650 <span style="color: #949494;">&lt;chr [3]&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> W3000049009 <span style="color: #949494;">&lt;lgl [1]&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> W2986617680 <span style="color: #949494;">&lt;chr [2]&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> W3042215340 <span style="color: #949494;">&lt;chr [3]&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> W2999558594 <span style="color: #949494;">&lt;chr [2]&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> W3038187379 <span style="color: #949494;">&lt;chr [10]&gt;</span></span></span>
<span></span>
<span><span class="co"># institutions of the first work</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">multi_insts</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"institutions"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; rowws_df [1 × 1] (S3: rowwise_df/tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ institutions:List of 1</span></span>
<span><span class="co">#&gt;   ..$ : chr [1:2] "University of Southern Denmark" "BI Norwegian Business School"</span></span>
<span><span class="co">#&gt;  - attr(*, "groups")= tibble [1 × 1] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ .rows: list&lt;int&gt; [1:1] </span></span>
<span><span class="co">#&gt;   .. ..$ : int 1</span></span>
<span><span class="co">#&gt;   .. ..@ ptype: int(0)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="list-output">List output<a class="anchor" aria-label="anchor" href="#list-output"></a>
</h3>
<p>If we want to get <em>all</em> the institutions that the authors of
these works are affiliated with (since one author may be affiliated with
more than one institution), you would want to work with the list
output.</p>
<p>As you can see, the nested list can be more convoluted to work
with:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">works_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oa_fetch.html">oa_fetch</a></span><span class="op">(</span></span>
<span>  entity <span class="op">=</span> <span class="st">"works"</span>,</span>
<span>  title.search <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bibliometric analysis"</span>, <span class="st">"science mapping"</span><span class="op">)</span>,</span>
<span>  cited_by_count <span class="op">=</span> <span class="st">"&gt;100"</span>,</span>
<span>  from_publication_date <span class="op">=</span> <span class="st">"2020-01-01"</span>,</span>
<span>  to_publication_date <span class="op">=</span> <span class="st">"2021-01-31"</span>,</span>
<span>  sort <span class="op">=</span> <span class="st">"cited_by_count:desc"</span>,</span>
<span>  output <span class="op">=</span> <span class="st">"list"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">work_authors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">works_list</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">author</span><span class="op">)</span></span>
<span></span>
<span><span class="va">unique_insts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>  <span class="va">work_authors</span>,</span>
<span>  \<span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>      <span class="va">z</span>, \<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">institutions</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">display_name</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">unique_insts</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "University of Southern Denmark" "BI Norwegian Business School"</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Massimo Aria, Trang Le.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
